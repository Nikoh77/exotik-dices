<form autocomplete="off">

{{#if editing}}
    <!-- ═══════════════════════════════════════ -->
    <!--  EDITOR VIEW                            -->
    <!-- ═══════════════════════════════════════ -->

    <div class="ekd-editor-toolbar">
        <a class="ekd-back"><i class="fas fa-arrow-left"></i> {{localize "EKD.Editor.BackToList"}}</a>
    </div>

    <!-- Name -->
    <div class="form-group">
        <label>{{localize "EKD.Editor.Name"}}</label>
        <div class="form-fields">
            <input type="text" name="name" value="{{dice.name}}" placeholder="My Custom Dice" />
        </div>
        <p class="notes">{{localize "EKD.Editor.NameHint"}}</p>
    </div>

    {{#if assetHint}}
    <div class="form-group ekd-asset-hint">
        <label>{{localize "EKD.Editor.AssetFolder"}}</label>
        <div class="form-fields">
            <code class="ekd-asset-path">{{assetHint}}</code>
        </div>
        <p class="notes">{{localize "EKD.Editor.AssetFolderHint"}}</p>
    </div>
    {{/if}}

    <!-- Denomination -->
    <div class="form-group">
        <label>{{localize "EKD.Editor.Denomination"}}</label>
        <div class="form-fields">
            <input type="text" name="denomination" value="{{dice.denomination}}"
                   maxlength="1" style="width:60px;text-align:center;" />
        </div>
        <p class="notes">{{localize "EKD.Editor.DenominationHint"}}</p>
    </div>

    <!-- Faces + Geometry (same row) -->
    <div class="ekd-faces-geometry-row">
        <div class="form-group ekd-fg-item">
            <label>{{localize "EKD.Editor.Faces"}}</label>
            <div class="form-fields">
                <select name="faces">
                    {{#each facesOptions}}
                    <option value="{{this.value}}" {{#if this.selected}}selected{{/if}}>{{this.label}}</option>
                    {{/each}}
                </select>
            </div>
        </div>
        {{#if showGeometry}}
        <div class="form-group ekd-fg-item">
            <label>{{localize "EKD.Editor.Geometry"}}</label>
            <div class="form-fields">
                <select name="geometry">
                    {{#each geometryOptions}}
                    <option value="{{this.value}}" {{#if this.selected}}selected{{/if}}>{{this.label}}</option>
                    {{/each}}
                </select>
            </div>
        </div>
        {{else}}
        <input type="hidden" name="geometry" value="standard" />
        {{/if}}
    </div>

    <!-- 3D DSN Preview -->
    <div class="ekd-3d-preview" data-dsn-type="{{previewDsnType}}" data-faces="{{faceCount}}"></div>

    <h3>{{localize "EKD.Editor.FaceConfig"}}</h3>

    <!-- Face grid -->
    <div class="ekd-faces-grid">
        {{#each faces}}
        <fieldset class="ekd-face-entry">
            <legend>{{localize "EKD.Editor.Face"}} {{this.number}}</legend>

            <!-- Reference dropdown -->
            <div class="form-group ekd-ref-group">
                <label>{{localize "EKD.Editor.FaceRef"}}</label>
                <div class="form-fields">
                    <select name="faceMap.{{this.index}}.refFace" class="ekd-ref-select">
                        <option value="">{{localize "EKD.Editor.FaceRefNone"}}</option>
                        {{#each this.allowedRefs}}
                        <option value="{{this.value}}" {{#if this.selected}}selected{{/if}}>
                            {{localize "EKD.Editor.Face"}} {{this.label}}
                        </option>
                        {{/each}}
                    </select>
                </div>
            </div>

            {{#if this.isRef}}
            <p class="ekd-ref-inherited">
                <i class="fas fa-link"></i>
                {{localize "EKD.Editor.FaceRefInherited"}} {{this.refLabel}}
            </p>
            {{else}}

            <div class="form-group">
                <label>{{localize "EKD.Editor.FaceLabel"}}</label>
                <div class="form-fields">
                    <input type="text" name="faceMap.{{this.index}}.label" value="{{this.label}}" />
                </div>
            </div>

            <div class="form-group">
                <label>{{localize "EKD.Editor.FaceTexture"}}</label>
                <div class="form-fields">
                    <button type="button" class="file-picker" data-type="image"
                            data-target="faceMap.{{this.index}}.texture">
                        <i class="fas fa-file-import fa-fw"></i>
                    </button>
                    <input class="image" type="text" name="faceMap.{{this.index}}.texture"
                           value="{{this.texture}}" placeholder="path/to/image.png" />
                </div>
                <img src="{{this.texture}}" class="ekd-face-preview"
                     style="{{#unless this.texture}}display:none{{/unless}}" alt="" />
            </div>

            <div class="form-group">
                <label>{{localize "EKD.Editor.FaceBump"}}</label>
                <div class="form-fields">
                    <button type="button" class="file-picker" data-type="image"
                            data-target="faceMap.{{this.index}}.bump">
                        <i class="fas fa-file-import fa-fw"></i>
                    </button>
                    <input class="image" type="text" name="faceMap.{{this.index}}.bump"
                           value="{{this.bump}}" placeholder="path/to/bump.png" />
                </div>
                <img src="{{this.bump}}" class="ekd-face-preview"
                     style="{{#unless this.bump}}display:none{{/unless}}" alt="" />
            </div>

            <div class="form-group">
                <label>{{localize "EKD.Editor.FaceIcon"}}</label>
                <div class="form-fields">
                    <button type="button" class="file-picker" data-type="image"
                            data-target="faceMap.{{this.index}}.icon">
                        <i class="fas fa-file-import fa-fw"></i>
                    </button>
                    <input class="image" type="text" name="faceMap.{{this.index}}.icon"
                           value="{{this.icon}}" placeholder="path/to/icon.svg" />
                </div>
                <img src="{{this.icon}}" class="ekd-face-preview"
                     style="{{#unless this.icon}}display:none{{/unless}}" alt="" />
            </div>

            {{/if}}
        </fieldset>
        {{/each}}
    </div>

    <!-- Save button (disabled until dirty) -->
    <div class="ekd-editor-footer">
        <button type="submit" class="ekd-save-btn" disabled>
            <i class="fas fa-save"></i> {{localize "EKD.Editor.Save"}}
        </button>
    </div>

{{else}}
    <!-- ═══════════════════════════════════════ -->
    <!--  LIST VIEW (fallback)                   -->
    <!-- ═══════════════════════════════════════ -->

    <p class="notes">{{localize "EKD.Config.Hint"}}</p>

    {{#if diceList.length}}
    <ol class="ekd-dice-list">
        {{#each diceList}}
        <li class="ekd-dice-entry flexrow" data-id="{{this.id}}">
            <span class="ekd-dice-name flex2">{{this.name}}</span>
            <span class="ekd-dice-denom flex0">d{{this.denomination}}</span>
            <span class="ekd-dice-faces flex0">{{this.faces}} {{localize "EKD.Config.FacesLabel"}}</span>
            <span class="ekd-dice-geometry flex1">{{this.geometryLabel}}</span>
            <div class="ekd-dice-controls flex0">
                {{#unless this.isDefault}}
                <a class="ekd-edit" data-id="{{this.id}}" title="{{localize 'EKD.Config.Edit'}}">
                    <i class="fas fa-edit"></i>
                </a>
                <a class="ekd-delete" data-id="{{this.id}}" title="{{localize 'EKD.Config.Delete'}}">
                    <i class="fas fa-trash"></i>
                </a>
                {{/unless}}
            </div>
        </li>
        {{/each}}
    </ol>
    {{else}}
    <p class="ekd-no-dice">{{localize "EKD.Config.NoDice"}}</p>
    {{/if}}

    <div class="ekd-config-buttons">
        <button type="button" class="ekd-add-dice">
            <i class="fas fa-plus"></i> {{localize "EKD.Config.AddDice"}}
        </button>
    </div>

{{/if}}

</form>
